# 🎭 ContestTrade 社区数据源使用指南

## 📖 概述

ContestTrade 框架现已支持社区数据源，能够从雪球、东方财富股吧等主流财经社区获取投资者讨论、KOL观点和市场情绪数据，大大提升系统对市场情绪和催化剂事件的感知能力。

## 🎯 核心功能

### 1. 社区情绪感知
- **多维度情绪分析**: 看多/看空倾向、情绪强度、恐慌/贪婪指数
- **情绪拐点识别**: 检测极端情绪向理性回归的转折信号
- **反向指标参考**: 当散户情绪过于一致时提供反向投资思考

### 2. KOL观点追踪
- **影响力用户识别**: 基于粉丝数、互动量筛选有价值的观点
- **观点分歧分析**: 分析意见领袖之间的观点差异程度
- **态度变化监控**: 追踪KOL投资观点的动态变化

### 3. 催化剂事件挖掘
- **热门话题识别**: 自动发现讨论热度激增的主题
- **突发事件捕获**: 从社区讨论中识别可能影响股价的事件
- **关注度变化追踪**: 监控特定股票或板块的关注度变化

## 🚀 快速开始

### 1. 检查配置
确保 `config.yaml` 中包含社区数据源配置：

```yaml
data_agents_config:
  - agent_name: "community_sentiment_agent"
    data_source_list:
      - "data_source.xueqiu_community_crawl.XueqiuCommunityCrawl"
      - "data_source.eastmoney_community_crawl.EastmoneyCommunityCrawl"
    bias_goal: "专注于捕获市场情绪变化、KOL观点分析和投资者行为模式，识别潜在的催化剂事件和情绪拐点"
    final_target_tokens: 5000
```

### 2. 测试社区数据源
运行测试脚本验证功能：

```bash
python test_community_data_sources.py
```

### 3. 启动完整分析
```bash
python -m cli.main run
```

系统会自动包含社区情绪分析，整个流程大约需要12-15分钟。

## ⚙️ 高级配置

### 雪球社区爬虫配置

```python
# 在 xueqiu_community_crawl.py 中可调整参数
XueqiuCommunityCrawl(
    max_posts=100,              # 最大获取帖子数
    min_follower_count=1000,    # KOL最低粉丝数阈值
    min_like_count=50          # 高质量帖子最低点赞数
)
```

### 东方财富股吧配置

```python
# 在 eastmoney_community_crawl.py 中可调整参数
EastmoneyCommunityCrawl(
    max_posts=100,    # 最大获取帖子数
    top_stocks=20     # 关注的热门股票数量
)
```

## 📊 数据字段说明

### 雪球数据字段
| 字段 | 说明 | 示例 |
|------|------|------|
| `title` | 帖子标题 | "茅台业绩超预期，看好后市发展" |
| `content` | 帖子内容 | 完整的帖子文本内容 |
| `author_followers` | 作者粉丝数 | 15000 |
| `sentiment` | 情绪倾向 | "bullish", "bearish", "neutral" |
| `influence_score` | 影响力分数 | 8.5 |
| `stock_mentions` | 提及的股票 | "SH600519,SZ000858" |

### 东方财富数据字段
| 字段 | 说明 | 示例 |
|------|------|------|
| `stock_code` | 讨论的股票代码 | "600519" |
| `read_count` | 阅读数 | 2500 |
| `sentiment_score` | 情绪评分 | 3.2 |
| `panic_level` | 恐慌程度 | 2 |
| `greed_level` | 贪婪程度 | 4 |
| `quality_score` | 帖子质量分数 | 6.8 |

## 🎨 情绪分析算法

### 情绪关键词体系
- **强烈看多**: 暴涨、涨停、突破、爆发、翻倍
- **温和看多**: 看多、上涨、利好、买入、加仓  
- **强烈看空**: 暴跌、跌停、崩盘、血崩、踩雷
- **温和看空**: 看空、下跌、利空、卖出、减仓
- **恐慌情绪**: 恐慌、害怕、担心、焦虑、绝望
- **贪婪情绪**: 贪婪、疯狂、狂欢、追高、梭哈

### 影响力计算公式
```
影响力分数 = min(粉丝数/10000, 5) + (点赞数×1 + 评论数×3 + 转发数×2)/100
```

## 📈 数据应用场景

### 1. 情绪反转信号
- 当散户情绪极度恐慌时，可能是底部机会
- 当市场情绪过度乐观时，需要警惕回调风险

### 2. 热点挖掘
- 识别讨论量激增的股票或概念
- 捕获可能成为市场焦点的新兴主题

### 3. KOL观点跟踪
- 分析头部用户的持仓变化和观点转向
- 评估不同观点之间的分歧程度

### 4. 催化剂预警
- 从社区讨论中发现可能影响股价的事件
- 提前布局或规避风险

## ⚡ 性能优化

### 1. 缓存机制
- 系统自动缓存已获取的数据，避免重复请求
- 缓存文件位于：`contest_trade/data_source/data_cache/`

### 2. 并发控制
- 支持多个数据源并发获取，提高效率
- 内置请求频率限制，避免被反爬虫系统封禁

### 3. 错误处理
- 网络异常时自动重试
- 单个数据源失败不影响其他数据源正常工作

## 🛡️ 注意事项

### 1. 合规使用
- 仅用于学术研究和个人投资参考
- 遵守各平台的robots.txt和使用条款
- 不进行大规模商业化数据采集

### 2. 数据免责
- 社区数据仅供参考，不构成投资建议
- 情绪分析结果可能存在偏差，需结合其他因素综合判断
- 投资有风险，决策需谨慎

### 3. 技术限制
- 部分网站可能有反爬虫机制，导致数据获取失败
- 网络环境和服务器响应可能影响数据完整性
- 建议在稳定的网络环境下使用

## 🔧 故障排除

### 常见问题

**Q: 获取不到社区数据？**
A: 检查网络连接，某些平台可能需要配置代理或更新请求头

**Q: 情绪分析结果不准确？**  
A: 可以调整情绪关键词词典，或增加更多样本数据进行训练

**Q: 系统运行变慢？**
A: 可以减少max_posts参数，或增加请求间隔时间

**Q: 部分数据源报错？**
A: 单个数据源异常不影响整体分析，系统会自动跳过异常源

## 📞 支持与反馈

如果您在使用过程中遇到问题或有改进建议，欢迎：

1. 查看项目文档：`架构图.md`
2. 运行测试脚本：`test_community_data_sources.py`
3. 查看日志文件：`agents_workspace/logs/`

---

**🎉 现在您可以体验更智能的市场情绪感知功能了！**